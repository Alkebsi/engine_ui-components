import{u as I,g as w,e as T,b3 as C,A as E,h as _,b2 as q,I as V,as as k,b4 as H,b5 as K,b6 as W,b7 as $,b8 as G,b9 as z,ba as U,ap as J}from"./index-B0-P1mHm.js";const X=e=>{const{components:i}=e,t=i.get(I),l=document.createElement("bim-table");l.columns=["Model"],l.headersHidden=!0;const r=[];for(const[,o]of t.groups){if(!o)continue;const u={data:{Model:o.name||o.uuid,Actions:o.uuid}};r.push(u)}return l.definition={Actions:o=>{if(typeof o!="string")return o;const u=t.groups.get(o);return u?w`
        <bim-button @click=${a=>{u.visible=!u.visible;const f=a.target;f.icon=u.visible?"mdi:eye":"mdi:eye-off"}} icon="mdi:eye"></bim-button>
        <bim-button @click=${()=>t.disposeGroup(u)} icon="mdi:delete"></bim-button>
      `:o}},l.columns=["Model",{name:"Actions",width:"auto"}],l.data=r,w`
    <div>
      ${r.length===0?w`<bim-label label="No models has been loaded yet"></bim-label>`:l}
    </div>
  `},Z=(e,i=!0)=>{const t=T.create(X,e);if(i){const{components:l}=e,r=l.get(I),[,o]=t;r.onFragmentsLoaded.add(()=>setTimeout(()=>o())),r.onFragmentsDisposed.add(()=>o())}return t},ee=Object.freeze(Object.defineProperty({__proto__:null,modelsList:Z},Symbol.toStringTag,{value:"Module"})),B=["Name","ContainedInStructure","ForLayerSet","LayerThickness","HasProperties","HasAssociations","HasAssignments","HasPropertySets","PredefinedType","Quantities","ReferencedSource","Identification",e=>e.includes("Value"),e=>e.startsWith("Material"),e=>e.startsWith("Relating"),e=>{const i=["IsGroupedBy","IsDecomposedBy"];return e.startsWith("Is")&&!i.includes(e)}];async function P(e,i,t,l=B,r=!1){const o=e.get(E),u=await i.getProperties(t);if(!u)return{data:{Entity:`${t} properties not found...`}};const d=o.relationMaps[i.uuid],s={data:{}};for(const a in u){const f=l.map(n=>typeof n=="string"?a===n:n(a)).includes(!0);if(!(a==="type"||f))continue;const c=u[a];if(c)if(c.type===5){s.children||(s.children=[]);const n=await P(e,i,c.value,l,r);s.children.push(n)}else if(typeof c=="object"&&!Array.isArray(c)){const{value:n,type:p}=c;if(r)p===1||p===2||p===3||(s.data[a]=n);else{const m=typeof n=="number"?Number(n.toFixed(3)):n;s.data[a]=m}}else if(Array.isArray(c))for(const n of c){if(n.type!==5)continue;s.children||(s.children=[]);const p=await P(e,i,n.value,l,r);s.children.push(p)}else if(a==="type"){const n=_[c];s.data.Entity=n}else s.data[a]=c}if(d&&d.get(u.expressID)){const a=d.get(u.expressID);for(const f of l){const c=[];if(typeof f=="string"){const n=o._inverseAttributes.indexOf(f);n!==-1&&c.push(n)}else{const n=o._inverseAttributes.filter(p=>f(p));for(const p of n){const m=o._inverseAttributes.indexOf(p);c.push(m)}}for(const n of c){const p=a.get(n);if(p)for(const m of p){const h=await P(e,i,m,l,r);s.children||(s.children=[]),s.children.push(h)}}}}return s}const te=e=>{const{components:i,fragmentIdMap:t,attributesToInclude:l,editable:r,tableDefinition:o}=e,u=i.get(I);let d;return typeof l=="function"?d=l(B):d=l,w`<bim-table ${C(async a=>{if(!a)return;const f=a,c=[],n=[];for(const p in t){const m=u.list.get(p);if(!(m&&m.group))continue;const h=m.group,b=n.find(y=>y.model===h);if(b)for(const y of t[p])b.expressIDs.add(y);else{const y={model:h,expressIDs:new Set(t[p])};n.push(y)}}for(const p of n){const{model:m,expressIDs:h}=p;for(const b of h){const y=await P(i,m,b,d,r);c.push(y)}}f.definition=o,f.data=c,f.columns=[{name:"Entity",width:"minmax(15rem, 1fr)"}]})}></bim-table>`},ne=e=>T.create(te,e),se=Object.freeze(Object.defineProperty({__proto__:null,entityAttributes:ne},Symbol.toStringTag,{value:"Module"}));function oe(e){const i=Object.keys(e).pop();return i&&e[i].length>0?e[i][0]:""}function Q(e){return e.map(i=>{const t={data:{System:oe(i.filter)}};return i.children&&i.children.length>0&&(t.children=Q(i.children)),t})}const ie=e=>{const{components:i,classifications:t}=e,l=i.get(q),r=o=>{if(!o)return;const u=o;u.definition={Actions:a=>a};const d=(a,f={})=>{const c=l.list,n=a[0],p=c[n],m=[];if(!n||!p)return m;for(const h in p){const b={...f,[n]:[h]},y=l.find(b);if(Object.keys(y).length>0){const S={filter:b};S.children=d(a.slice(1),b),m.push(S)}}return m},s=[];for(const a in t){const f=t[a],c=d(f),n=Q(c);s.push({data:{System:a},children:n})}u.data=s};return w`
  <div>
    ${Object.keys(t).length===0?w`<bim-label label="No classifications to show"></bim-label>`:w`<bim-table ${C(r)} headers-hidden expanded></bim-table>`}
  </div>
  `},ae=(e,i=!0)=>{const t=T.create(ie,e);if(i){const{components:l}=e,r=l.get(I),[,o]=t;r.onFragmentsDisposed.add(()=>o())}return t},re=Object.freeze(Object.defineProperty({__proto__:null,classificationTree:ae},Symbol.toStringTag,{value:"Module"})),ce=["OwnerHistory","ObjectPlacement","CompositionType"],F=async(e,i,t)=>{const r={...{groupName:"Attributes",includeClass:!1},...t},{groupName:o,includeClass:u}=r,d=await e.getProperties(i)??{},s={data:{Name:o}};u&&(s.children||(s.children=[]),s.children.push({data:{Name:"Class",Value:_[d.type]}}));for(const a in d){if(ce.includes(a))continue;const f=d[a];if(f&&typeof f=="object"&&!Array.isArray(f)){if(f.type===U)continue;const c={data:{Name:a,Value:f.value}};s.children||(s.children=[]),s.children.push(c)}}return s},le=async(e,i)=>{const t={data:{Name:"Property Sets"}};for(const l of i){const r=await e.getProperties(l);if(!r)continue;const o={data:{Name:r.Name.value}};if(r.type===V){for(const u of r.HasProperties){const{value:d}=u,s=await e.getProperties(d);if(!s)continue;const a=Object.keys(s).find(c=>c.includes("Value"));if(!(a&&s[a]))continue;const f={data:{Name:s.Name.value,Value:s[a].value}};o.children||(o.children=[]),o.children.push(f)}o.children&&(t.children||(t.children=[]),t.children.push(o))}}return t},ue=async(e,i)=>{const t={data:{Name:"Quantity Sets"}};for(const l of i){const r=await e.getProperties(l);if(!r)continue;const o={data:{Name:r.Name.value}};if(r.type===k){for(const u of r.Quantities){const{value:d}=u,s=await e.getProperties(d);if(!s)continue;const a=Object.keys(s).find(c=>c.includes("Value"));if(!(a&&s[a]))continue;const f={data:{Name:s.Name.value,Value:s[a].value}};o.children||(o.children=[]),o.children.push(f)}o.children&&(t.children||(t.children=[]),t.children.push(o))}}return t},de=async(e,i)=>{const t={data:{Name:"Materials"}};for(const l of i){const r=await e.getProperties(l);if(r.type===H){const o=r.ForLayerSet.value,u=await e.getProperties(o);for(const d of u.MaterialLayers){const{value:s}=d,a=await e.getProperties(s),f=await e.getProperties(a.Material.value),c={data:{Name:"Layer"},children:[{data:{Name:"Thickness",Value:a.LayerThickness.value}},{data:{Name:"Material",Value:f.Name.value}}]};t.children||(t.children=[]),t.children.push(c)}}if(r.type===G)for(const o of r.Materials){const{value:u}=o,s={data:{Name:"Name",Value:(await e.getProperties(u)).Name.value}};t.children||(t.children=[]),t.children.push(s)}if(r.type===$){const u={data:{Name:"Name",Value:(await e.getProperties(l)).Name.value}};t.children||(t.children=[]),t.children.push(u)}}return t},fe=async(e,i)=>{var l,r;const t={data:{Name:"Classifications"}};for(const o of i){const u=await e.getProperties(o);if(u.type===z){const{value:d}=u.ReferencedSource,a={data:{Name:(await e.getProperties(d)).Name.value},children:[{data:{Name:"Identification",Value:((l=u.Identification)==null?void 0:l.value)||((r=u.ItemReference)==null?void 0:r.value)}},{data:{Name:"Name",Value:u.Name.value}}]};t.children||(t.children=[]),t.children.push(a)}}return t},pe=e=>{const{components:i,fragmentIdMap:t}=e,l=i.get(E),r=i.get(I);return w`<bim-table ${C(async u=>{var f;if(!u)return;const d=[],s=[];for(const c in t){const n=r.list.get(c);if(!(n&&n.group))continue;const p=n.group,m=s.find(h=>h.model===p);if(m)for(const h of t[c])m.expressIDs.add(h);else{const h={model:p,expressIDs:new Set(t[c])};s.push(h)}}for(const c in s){const{model:n,expressIDs:p}=s[c],m=l.relationMaps[n.uuid];if(!m)return;for(const h of p){const b=await n.getProperties(h);if(!b)continue;const y={data:{Name:(f=b.Name)==null?void 0:f.value,Value:""}};d.push(y);const L=await F(n,h,{includeClass:!0});if(y.children||(y.children=[]),y.children.push(L),!m.get(h))continue;const D=l.getEntityRelations(n,h,"IsDefinedBy");if(D){const v=D.filter(async R=>{const g=await n.getProperties(R);return g?g.type===V:!1}),A=await le(n,v);A.children&&y.children.push(A);const x=D.filter(async R=>{const g=await n.getProperties(R);return g?g.type===k:!1}),N=await ue(n,x);N.children&&y.children.push(N)}const M=l.getEntityRelations(n,h,"HasAssociations");if(M){const v=M.filter(async R=>{const g=await n.getProperties(R);return g?g.type===H||g.type===K||g.type===W||g.type===$||g.type===G:!1}),A=await de(n,v);A.children&&y.children.push(A);const x=M.filter(async R=>{const g=await n.getProperties(R);return g?g.type===z:!1}),N=await fe(n,x);N.children&&y.children.push(N)}const j=l.getEntityRelations(n,h,"ContainedInStructure");if(j){const v=j[0],A=await F(n,v,{groupName:"SpatialContainer"});y.children.push(A)}}}const a=u;a.columns=[{name:"Name",width:"12rem"}],a.data=d})} headers-hidden></bim-table>`},me=e=>T.create(pe,e),he=Object.freeze(Object.defineProperty({__proto__:null,elementProperties:me},Symbol.toStringTag,{value:"Module"})),O=async(e,i,t,l)=>{var a;const r=[],o=e.get(E),u=await i.getProperties(t);if(!u)return r;const{type:d}=u,s={data:{Entity:_[d],Name:(a=u.Name)==null?void 0:a.value}};for(const f of l){const c=o.getEntityRelations(i,t,f);if(c)for(const n of c){const p=await O(e,i,n,l);s.children||(s.children=[]),s.children.push(...p)}}return r.push(s),r},ye=e=>{const{components:i,models:t,inverseAttributes:l,expressID:r}=e,o=l??["IsDecomposedBy","ContainsElements"];return w`<bim-table ${C(async d=>{if(!d)return;const s=i.get(E),a=[];for(const c of t){let n;if(r)n={data:{Entity:c.name!==""?c.name:c.uuid},children:await O(i,c,r,o)};else{const p=s.relationMaps[c.uuid],m=await c.getAllPropertiesOfType(J);if(!(p&&m))continue;const{expressID:h}=Object.values(m)[0];n={data:{Entity:c.name!==""?c.name:c.uuid},children:await O(i,c,h,o)}}a.push(n)}const f=d;f.columns=["Entity","Name"],f.data=a})} headers-hidden></bim-table>`},ge=(e,i=!0)=>{const t=T.create(ye,e);if(i){const[,l]=t,{components:r}=e,o=r.get(I),u=r.get(E),d=()=>l({models:o.groups.values()});u.onRelationsIndexed.add(d),o.onFragmentsDisposed.add(d)}return t},be=Object.freeze(Object.defineProperty({__proto__:null,relationsTree:ge},Symbol.toStringTag,{value:"Module"})),Ae={...ee,...se,...re,...he,...be};export{Ae as t};
