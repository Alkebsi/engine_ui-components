import{u as I,g as w,e as T,b3 as P,A as E,h as _,b2 as Y,I as V,as as k,b4 as H,b5 as K,b6 as W,b7 as $,b8 as q,b9 as G,ba as U,ap as J}from"./index-BezPsGgn.js";const X=t=>{const{components:i}=t,n=i.get(I),l=document.createElement("bim-table");l.columns=["Model"],l.headersHidden=!0;const c=[];for(const[,o]of n.groups){if(!o)continue;const u={data:{Model:o.name||o.uuid,Actions:o.uuid}};c.push(u)}return l.dataTransform={Actions:o=>{if(typeof o!="string")return o;const u=n.groups.get(o);return u?w`
        <bim-button @click=${r=>{u.visible=!u.visible;const d=r.target;d.icon=u.visible?"mdi:eye":"mdi:eye-off"}} icon="mdi:eye"></bim-button>
        <bim-button @click=${()=>n.disposeGroup(u)} icon="mdi:delete"></bim-button>
      `:o}},l.columns=["Model",{name:"Actions",width:"auto"}],l.data=c,w`
    <div>
      ${c.length===0?w`<bim-label>No models has been loaded yet</bim-label>`:l}
    </div>
  `},Z=(t,i=!0)=>{const n=T.create(X,t);if(i){const{components:l}=t,c=l.get(I),[,o]=n;c.onFragmentsLoaded.add(()=>setTimeout(()=>o())),c.onFragmentsDisposed.add(()=>o())}return n},ee=Object.freeze(Object.defineProperty({__proto__:null,modelsList:Z},Symbol.toStringTag,{value:"Module"})),z=["Name","ContainedInStructure","ForLayerSet","LayerThickness","HasProperties","HasAssociations","HasAssignments","HasPropertySets","PredefinedType","Quantities","ReferencedSource","Identification",t=>t.includes("Value"),t=>t.startsWith("Material"),t=>t.startsWith("Relating"),t=>{const i=["IsGroupedBy","IsDecomposedBy"];return t.startsWith("Is")&&!i.includes(t)}];async function C(t,i,n,l=z,c=!1){const o=t.get(E),u=await i.getProperties(n);if(!u)return{data:{Entity:`${n} properties not found...`}};const p=o.relationMaps[i.uuid],s={data:{}};for(const r in u){const d=l.map(e=>typeof e=="string"?r===e:e(r)).includes(!0);if(!(r==="type"||d))continue;const a=u[r];if(a)if(a.type===5){s.children||(s.children=[]);const e=await C(t,i,a.value,l,c);s.children.push(e)}else if(typeof a=="object"&&!Array.isArray(a)){const{value:e,type:f}=a;if(c)f===1||f===2||f===3||(s.data[r]=e);else{const m=typeof e=="number"?Number(e.toFixed(3)):e;s.data[r]=m}}else if(Array.isArray(a))for(const e of a){if(e.type!==5)continue;s.children||(s.children=[]);const f=await C(t,i,e.value,l,c);s.children.push(f)}else if(r==="type"){const e=_[a];s.data.Entity=e}else s.data[r]=a}if(p&&p.get(u.expressID)){const r=p.get(u.expressID);for(const d of l){const a=[];if(typeof d=="string"){const e=o._inverseAttributes.indexOf(d);e!==-1&&a.push(e)}else{const e=o._inverseAttributes.filter(f=>d(f));for(const f of e){const m=o._inverseAttributes.indexOf(f);a.push(m)}}for(const e of a){const f=r.get(e);if(f)for(const m of f){const y=await C(t,i,m,l,c);s.children||(s.children=[]),s.children.push(y)}}}}return s}const te=t=>{const{components:i,fragmentIdMap:n,attributesToInclude:l,editable:c,tableDefinition:o}=t,u=i.get(I);let p;return typeof l=="function"?p=l(z):p=l,w`<bim-table ${P(async r=>{if(!r)return;const d=r,a=[],e=[];for(const f in n){const m=u.list.get(f);if(!(m&&m.group))continue;const y=m.group,b=e.find(h=>h.model===y);if(b)for(const h of n[f])b.expressIDs.add(h);else{const h={model:y,expressIDs:new Set(n[f])};e.push(h)}}for(const f of e){const{model:m,expressIDs:y}=f;for(const b of y){const h=await C(i,m,b,p,c);a.push(h)}}d.dataTransform=o,d.data=a,d.columns=[{name:"Entity",width:"minmax(15rem, 1fr)"}]})}></bim-table>`},ne=t=>T.create(te,t),se=Object.freeze(Object.defineProperty({__proto__:null,entityAttributes:ne},Symbol.toStringTag,{value:"Module"}));function oe(t){const i=Object.keys(t).pop();return i&&t[i].length>0?t[i][0]:""}function B(t){return t.map(i=>{const n={data:{System:oe(i.filter)}};return i.children&&i.children.length>0&&(n.children=B(i.children)),n})}const ae=t=>{const{components:i,classifications:n}=t,l=i.get(Y),c=o=>{if(!o)return;const u=o;u.dataTransform={Actions:r=>r};const p=(r,d={})=>{const a=l.list,e=r[0],f=a[e],m=[];if(!e||!f)return m;for(const y in f){const b={...d,[e]:[y]},h=l.find(b);if(Object.keys(h).length>0){const S={filter:b};S.children=p(r.slice(1),b),m.push(S)}}return m},s=[];for(const r in n){const d=n[r],a=p(d),e=B(a);s.push({data:{System:r},children:e})}u.data=s};return w`
  <div>
    ${Object.keys(n).length===0?w`<bim-label label="No classifications to show"></bim-label>`:w`<bim-table ${P(c)} headers-hidden expanded></bim-table>`}
  </div>
  `},ie=(t,i=!0)=>{const n=T.create(ae,t);if(i){const{components:l}=t,c=l.get(I),[,o]=n;c.onFragmentsDisposed.add(()=>o())}return n},re=Object.freeze(Object.defineProperty({__proto__:null,classificationTree:ie},Symbol.toStringTag,{value:"Module"})),ce=["OwnerHistory","ObjectPlacement","CompositionType"],F=async(t,i,n)=>{const c={...{groupName:"Attributes",includeClass:!1},...n},{groupName:o,includeClass:u}=c,p=await t.getProperties(i)??{},s={data:{Name:o}};u&&(s.children||(s.children=[]),s.children.push({data:{Name:"Class",Value:_[p.type]}}));for(const r in p){if(ce.includes(r))continue;const d=p[r];if(d&&typeof d=="object"&&!Array.isArray(d)){if(d.type===U)continue;const a={data:{Name:r,Value:d.value}};s.children||(s.children=[]),s.children.push(a)}}return s},le=async(t,i)=>{const n={data:{Name:"Property Sets"}};for(const l of i){const c=await t.getProperties(l);if(!c)continue;const o={data:{Name:c.Name.value}};if(c.type===V){for(const u of c.HasProperties){const{value:p}=u,s=await t.getProperties(p);if(!s)continue;const r=Object.keys(s).find(a=>a.includes("Value"));if(!(r&&s[r]))continue;const d={data:{Name:s.Name.value,Value:s[r].value}};o.children||(o.children=[]),o.children.push(d)}o.children&&(n.children||(n.children=[]),n.children.push(o))}}return n},ue=async(t,i)=>{const n={data:{Name:"Quantity Sets"}};for(const l of i){const c=await t.getProperties(l);if(!c)continue;const o={data:{Name:c.Name.value}};if(c.type===k){for(const u of c.Quantities){const{value:p}=u,s=await t.getProperties(p);if(!s)continue;const r=Object.keys(s).find(a=>a.includes("Value"));if(!(r&&s[r]))continue;const d={data:{Name:s.Name.value,Value:s[r].value}};o.children||(o.children=[]),o.children.push(d)}o.children&&(n.children||(n.children=[]),n.children.push(o))}}return n},de=async(t,i)=>{const n={data:{Name:"Materials"}};for(const l of i){const c=await t.getProperties(l);if(c.type===H){const o=c.ForLayerSet.value,u=await t.getProperties(o);for(const p of u.MaterialLayers){const{value:s}=p,r=await t.getProperties(s),d=await t.getProperties(r.Material.value),a={data:{Name:"Layer"},children:[{data:{Name:"Thickness",Value:r.LayerThickness.value}},{data:{Name:"Material",Value:d.Name.value}}]};n.children||(n.children=[]),n.children.push(a)}}if(c.type===q)for(const o of c.Materials){const{value:u}=o,s={data:{Name:"Name",Value:(await t.getProperties(u)).Name.value}};n.children||(n.children=[]),n.children.push(s)}if(c.type===$){const u={data:{Name:"Name",Value:(await t.getProperties(l)).Name.value}};n.children||(n.children=[]),n.children.push(u)}}return n},fe=async(t,i)=>{var l,c;const n={data:{Name:"Classifications"}};for(const o of i){const u=await t.getProperties(o);if(u.type===G){const{value:p}=u.ReferencedSource,r={data:{Name:(await t.getProperties(p)).Name.value},children:[{data:{Name:"Identification",Value:((l=u.Identification)==null?void 0:l.value)||((c=u.ItemReference)==null?void 0:c.value)}},{data:{Name:"Name",Value:u.Name.value}}]};n.children||(n.children=[]),n.children.push(r)}}return n},pe=t=>{const{components:i,fragmentIdMap:n}=t,l=i.get(E),c=i.get(I);return w`<bim-table ${P(async u=>{var d;if(!u)return;const p=[],s=[];for(const a in n){const e=c.list.get(a);if(!(e&&e.group))continue;const f=e.group,m=s.find(y=>y.model===f);if(m)for(const y of n[a])m.expressIDs.add(y);else{const y={model:f,expressIDs:new Set(n[a])};s.push(y)}}for(const a in s){const{model:e,expressIDs:f}=s[a],m=l.relationMaps[e.uuid];if(!m)return;for(const y of f){const b=await e.getProperties(y);if(!b)continue;const h={data:{Name:(d=b.Name)==null?void 0:d.value,Value:""}};p.push(h);const L=await F(e,y,{includeClass:!0});if(h.children||(h.children=[]),h.children.push(L),!m.get(y))continue;const D=l.getEntityRelations(e,y,"IsDefinedBy");if(D){const N=D.filter(async R=>{const g=await e.getProperties(R);return g?g.type===V:!1}),A=await le(e,N);A.children&&h.children.push(A);const x=D.filter(async R=>{const g=await e.getProperties(R);return g?g.type===k:!1}),v=await ue(e,x);v.children&&h.children.push(v)}const M=l.getEntityRelations(e,y,"HasAssociations");if(M){const N=M.filter(async R=>{const g=await e.getProperties(R);return g?g.type===H||g.type===K||g.type===W||g.type===$||g.type===q:!1}),A=await de(e,N);A.children&&h.children.push(A);const x=M.filter(async R=>{const g=await e.getProperties(R);return g?g.type===G:!1}),v=await fe(e,x);v.children&&h.children.push(v)}const j=l.getEntityRelations(e,y,"ContainedInStructure");if(j){const N=j[0],A=await F(e,N,{groupName:"SpatialContainer"});h.children.push(A)}}}const r=u;r.addEventListener("cellcreated",({detail:a})=>{const e=a.cell.parentNode;if(!e)return;const f=e.querySelector("bim-table-cell[column='Name']"),m=e.querySelector("bim-table-cell[column='Value']");!(m!=null&&m.data)&&f&&(f.style.gridColumn="1 / -1")}),r.columns=[{name:"Name",width:"12rem"}],r.data=p})} headers-hidden></bim-table>`},me=t=>T.create(pe,t),ye=Object.freeze(Object.defineProperty({__proto__:null,elementProperties:me},Symbol.toStringTag,{value:"Module"})),O=async(t,i,n,l)=>{var r;const c=[],o=t.get(E),u=await i.getProperties(n);if(!u)return c;const{type:p}=u,s={data:{Entity:_[p],Name:(r=u.Name)==null?void 0:r.value}};for(const d of l){const a=o.getEntityRelations(i,n,d);if(a)for(const e of a){const f=await O(t,i,e,l);s.children||(s.children=[]),s.children.push(...f)}}return c.push(s),c},he=t=>{const{components:i,models:n,inverseAttributes:l,expressID:c}=t,o=l??["IsDecomposedBy","ContainsElements"];return w`<bim-table ${P(async p=>{if(!p)return;const s=i.get(E),r=[];for(const a of n){let e;if(c)e={data:{Entity:a.name!==""?a.name:a.uuid},children:await O(i,a,c,o)};else{const f=s.relationMaps[a.uuid],m=await a.getAllPropertiesOfType(J);if(!(f&&m))continue;const{expressID:y}=Object.values(m)[0];e={data:{Entity:a.name!==""?a.name:a.uuid},children:await O(i,a,y,o)}}r.push(e)}const d=p;d.addEventListener("cellcreated",({detail:a})=>{const e=a.cell.parentNode;if(!e)return;const f=e.querySelector("bim-table-cell[column='Entity']"),m=e.querySelector("bim-table-cell[column='Name']");!(m!=null&&m.data)&&f&&(f.style.gridColumn="1 / -1")}),d.columns=["Entity","Name"],d.data=r})} headers-hidden></bim-table>`},ge=(t,i=!0)=>{const n=T.create(he,t);if(i){const[,l]=n,{components:c}=t,o=c.get(I),u=c.get(E),p=()=>l({models:o.groups.values()});u.onRelationsIndexed.add(p),o.onFragmentsDisposed.add(p)}return n},be=Object.freeze(Object.defineProperty({__proto__:null,relationsTree:ge},Symbol.toStringTag,{value:"Module"})),Ae={...ee,...se,...re,...ye,...be};export{Ae as t};
